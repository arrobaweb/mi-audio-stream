<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Oído 3.0</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            text-align: center; 
            background-color: #121212; 
            color: #e0e0e0; 
            padding: 20px;
            margin: 0;
            overscroll-behavior: none; /* Evita rebote en móviles */
        }
        h1 { color: #00d2ff; margin: 10px 0; font-size: 22px; text-transform: uppercase; letter-spacing: 2px;}

        /* Botón de Encendido Estilo "Neon" */
        #btnPower {
            width: 100px; height: 100px; 
            border-radius: 50%; border: 3px solid #333;
            background: #1e1e1e; color: #555; 
            font-size: 16px; font-weight: bold; cursor: pointer;
            box-shadow: inset 0 0 20px #000;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: 20px auto;
            display: flex; align-items: center; justify-content: center;
        }
        
        #btnPower.on {
            background: #00d2ff; color: #000;
            border-color: #fff;
            box-shadow: 0 0 30px #00d2ff, inset 0 0 10px #fff;
            transform: scale(1.1);
        }

        /* Panel de Controles */
        .panel {
            background: #1e1e1e;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .label-group { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; color: #aaa;}
        .label-val { color: #00d2ff; font-weight: bold;}

        /* Estilo de los Sliders */
        input[type=range] {
            width: 100%; height: 8px; border-radius: 5px;
            background: #333; outline: none; -webkit-appearance: none;
            margin-bottom: 15px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px; border-radius: 50%;
            background: #00d2ff; cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 210, 255, 0.5);
        }
        
        /* Colores específicos para cada banda */
        .bass-slider::-webkit-slider-thumb { background: #ff4757; box-shadow: 0 0 10px rgba(255, 71, 87, 0.5); }
        .mid-slider::-webkit-slider-thumb { background: #ffa502; box-shadow: 0 0 10px rgba(255, 165, 2, 0.5); }
        .treble-slider::-webkit-slider-thumb { background: #2ed573; box-shadow: 0 0 10px rgba(46, 213, 115, 0.5); }

    </style>
</head>
<body>

    <h1>Super Oído 3.0</h1>
    <div style="font-size: 0.8em; color: #666;">Ecualizador Pro</div>

    <div id="btnPower">OFF</div>

    <div class="panel">
        <div class="label-group">
            <span>Volumen Maestro</span>
            <span class="label-val" id="volVal">1.0x</span>
        </div>
        <input type="range" id="volControl" min="1" max="30" step="0.5" value="1">
    </div>

    <div class="panel">
        <div class="label-group">
            <span>Bajos (Cuerpo)</span>
            <span class="label-val" id="bassVal">0 dB</span>
        </div>
        <input type="range" class="bass-slider" id="bassControl" min="-20" max="20" step="1" value="0">

        <div class="label-group">
            <span>Medios (Voz)</span>
            <span class="label-val" id="midVal">0 dB</span>
        </div>
        <input type="range" class="mid-slider" id="midControl" min="-20" max="20" step="1" value="0">

        <div class="label-group">
            <span>Agudos (Claridad)</span>
            <span class="label-val" id="trebleVal">0 dB</span>
        </div>
        <input type="range" class="treble-slider" id="trebleControl" min="-20" max="20" step="1" value="10">
    </div>

    <script>
        let ctx;
        let source;
        let gainNode;
        // Filtros del Ecualizador
        let bassFilter, midFilter, trebleFilter;
        let isOn = false;

        const btn = document.getElementById('btnPower');
        
        // Elementos UI
        const ui = {
            vol: { input: document.getElementById('volControl'), label: document.getElementById('volVal') },
            bass: { input: document.getElementById('bassControl'), label: document.getElementById('bassVal') },
            mid: { input: document.getElementById('midControl'), label: document.getElementById('midVal') },
            treble: { input: document.getElementById('trebleControl'), label: document.getElementById('trebleVal') }
        };

        btn.addEventListener('click', async () => {
            if (!isOn) {
                try {
                    // 1. Iniciar Contexto
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    ctx = new AudioContext({ latencyHint: 'interactive', sampleRate: 48000 });

                    // 2. Micrófono (Crudo)
                    const stream = await navigator.mediaDevices.getUserMedia({
                        audio: {
                            echoCancellation: false,
                            noiseSuppression: false,
                            autoGainControl: false,
                            latency: 0
                        }
                    });

                    // 3. Crear Nodos
                    source = ctx.createMediaStreamSource(stream);
                    gainNode = ctx.createGain();
                    
                    // --- CREACIÓN DEL ECUALIZADOR ---
                    
                    // Bajos (LowShelf): Afecta todo lo que esté debajo de 250Hz
                    bassFilter = ctx.createBiquadFilter();
                    bassFilter.type = "lowshelf";
                    bassFilter.frequency.value = 250; 

                    // Medios (Peaking): Afecta la zona de la voz (alrededor de 1500Hz)
                    midFilter = ctx.createBiquadFilter();
                    midFilter.type = "peaking";
                    midFilter.frequency.value = 1500;
                    midFilter.Q.value = 1; // Ancho de banda de la curva

                    // Agudos (HighShelf): Afecta todo lo que esté por encima de 3000Hz
                    trebleFilter = ctx.createBiquadFilter();
                    trebleFilter.type = "highshelf";
                    trebleFilter.frequency.value = 3000;

                    // 4. Conectar la cadena (El tren de audio)
                    // Mic -> Bajos -> Medios -> Agudos -> Volumen -> Salida
                    source.connect(bassFilter);
                    bassFilter.connect(midFilter);
                    midFilter.connect(trebleFilter);
                    trebleFilter.connect(gainNode);
                    gainNode.connect(ctx.destination);

                    // 5. Aplicar valores actuales de los sliders
                    updateAudioValues();

                    // UI ON
                    isOn = true;
                    btn.innerText = "ON";
                    btn.classList.add('on');

                } catch (e) { alert("Error: " + e.message); }
            } else {
                if (ctx) ctx.close();
                isOn = false;
                btn.innerText = "OFF";
                btn.classList.remove('on');
            }
        });

        // Función para actualizar valores en tiempo real
        function updateAudioValues() {
            // Actualizar etiquetas de texto
            ui.vol.label.innerText = ui.vol.input.value + "x";
            ui.bass.label.innerText = (ui.bass.input.value > 0 ? "+" : "") + ui.bass.input.value + " dB";
            ui.mid.label.innerText = (ui.mid.input.value > 0 ? "+" : "") + ui.mid.input.value + " dB";
            ui.treble.label.innerText = (ui.treble.input.value > 0 ? "+" : "") + ui.treble.input.value + " dB";

            // Si el audio está encendido, aplicar al sonido
            if (isOn && gainNode) {
                gainNode.gain.value = ui.vol.input.value;
                bassFilter.gain.value = ui.bass.input.value;
                midFilter.gain.value = ui.mid.input.value;
                trebleFilter.gain.value = ui.treble.input.value;
            }
        }

        // Escuchar cambios en los sliders
        Object.values(ui).forEach(control => {
            control.input.addEventListener('input', updateAudioValues);
        });

    </script>
</body>
</html>