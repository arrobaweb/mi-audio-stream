<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Oído</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            background-color: #121212; 
            color: white; 
            padding-top: 50px;
            margin: 0;
            overflow: hidden; /* Evitar scroll */
        }
        h1 { color: #00d2ff; margin-bottom: 5px; font-size: 24px;}
        p { color: #888; margin-bottom: 40px; font-size: 14px;}

        /* Botón gigante */
        #btnPower {
            width: 140px; height: 140px; 
            border-radius: 50%; border: 4px solid #333;
            background-color: #1e1e1e; color: #555; 
            font-size: 20px; font-weight: bold; cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: all 0.2s ease;
            margin-bottom: 30px;
        }
        
        #btnPower.on {
            background-color: #00d2ff; color: #000;
            border-color: #fff;
            box-shadow: 0 0 40px #00d2ff;
        }

        .controls { 
            background: #222; 
            padding: 20px; 
            border-radius: 20px 20px 0 0; 
            position: fixed; bottom: 0; left: 0; right: 0;
        }
        
        label { display: block; font-size: 1.2rem; margin-bottom: 15px; color: #fff;}
        
        /* Slider Estilizado */
        input[type=range] {
            width: 100%; height: 15px; border-radius: 10px;
            background: #444; outline: none; accent-color: #00d2ff;
        }
    </style>
</head>
<body>

    <h1>Super Oído 2.0</h1>
    <p>Calidad HD + Filtro Claridad</p>

    <button id="btnPower">OFF</button>

    <div class="controls">
        <label>Ganancia: <span id="volText">1.0</span>x</label>
        <input type="range" id="volControl" min="1" max="30" step="0.5" value="1">
    </div>

    <script>
        let audioContext;
        let micSource;
        let gainNode;
        let trebleFilter;
        let isOn = false;

        const btn = document.getElementById('btnPower');
        const volSlider = document.getElementById('volControl');
        const volText = document.getElementById('volText');

        btn.addEventListener('click', async () => {
            if (!isOn) {
                try {
                    // 1. Configuración de Alta Fidelidad
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    audioContext = new AudioContext({ 
                        latencyHint: 'interactive',
                        sampleRate: 48000 // Forzar calidad HD
                    });

                    // 2. Pedir micrófono SIN PROCESAMIENTO (Audio crudo)
                    const stream = await navigator.mediaDevices.getUserMedia({
                        audio: {
                            echoCancellation: false, // Vital para evitar sonido de caja
                            noiseSuppression: false, // Vital para evitar sonido de caja
                            autoGainControl: false,  // Controlamos volumen nosotros
                            channelCount: 1          // Mono (mejor para voz)
                        }
                    });

                    // 3. Crear Nodos
                    micSource = audioContext.createMediaStreamSource(stream);
                    gainNode = audioContext.createGain();
                    
                    // --- FILTRO ANTI-CAJA (Realce de Agudos) ---
                    trebleFilter = audioContext.createBiquadFilter();
                    trebleFilter.type = "highshelf"; // Filtro de estante alto
                    trebleFilter.frequency.value = 2500; // A partir de 2500Hz
                    trebleFilter.gain.value = 10; // Subir 10 decibeles los agudos (Claridad)

                    // 4. Conectar cables: Mic -> Filtro -> Volumen -> Salida
                    micSource.connect(trebleFilter);
                    trebleFilter.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    // Actualizar UI
                    isOn = true;
                    btn.innerText = "ON";
                    btn.classList.add('on');

                    // Aplicar volumen inicial del slider
                    gainNode.gain.value = volSlider.value;
                    
                } catch (error) {
                    alert("Error: " + error.message);
                }
            } else {
                if (audioContext) audioContext.close();
                isOn = false;
                btn.innerText = "OFF";
                btn.classList.remove('on');
            }
        });

        volSlider.addEventListener('input', (e) => {
            const val = e.target.value;
            volText.innerText = val;
            if (gainNode) gainNode.gain.value = val;
        });
    </script>
</body>
</html>